---
title: "R Notebook"
output: html_notebook
---

```{r}
library(ggplot2)
library(magrittr)
library(tidyverse)
```

# Read data

```{r}
# setwd("/Users/joergensen/Documents/DTU_Mat_Tek/4.semester/02417_TimeSeriesAnalysis/Assignment_3_Laws")
data <- read.csv(file = 'DataAssignment3.csv')
parti_color=data$Government
parti_color[data$Government=="Social Democrats"]='#b02424'
parti_color[data$Government=="Venstre"]='#304c74'
parti_color[data$Government=="Conservative"]='#90a424'
parti_color[data$Government=="Social Liberals"]='green'
parti_color[data$Government=="Independent"]='yellow'
head(data)
```



## Plot data

```{r}
(plot <- ggplot(data = data)+
  geom_point(aes(x=Date,y=NumberWords))+
  geom_rect(data=data,aes(xmin = Date, xmax = Date+1,
                 ymin = -Inf, ymax = Inf,fill=Government),alpha=0.55)+
  geom_point(aes(x=Date,y=NumberWords))+
  geom_line(aes(x=Date,y=NumberWords)))

# plot

```


## Transform data

```{r}
diff_order <- 2

data <- data %>%
  mutate(NumberWordsTrans = data %>% .$NumberWords %>% log() %>%  diff(differences = diff_order) %>% c(rep(NA, diff_order), .)) %>% 
  # caret::dummyVars()
  mutate(Conservative = ifelse(Government == "Conservative", 1,0)) %>% #replace(TRUE, 1) %>% replace(FALSE, 0)) %>%
  mutate(Independent = ifelse(Government == "Independent", 1,0)) %>%
  mutate("Social Democrates" = ifelse(Government == "Social Democrats", 1,0)) %>%
  mutate("Social Liberals" = ifelse(Government == "Social Liberals", 1,0)) %>%
  mutate("Venstre" = ifelse(Government == "Venstre", 1,0))
data

# data$Government == "Conservative" %>% as.vector() %>% as.logical() %>%  as.integer()
  # sapply(FUN = as.integer)
# as.integer(T)
```

## Plot transformed data

```{r}
(plot <- ggplot(data = data)+
  geom_point(aes(x=Date,y=NumberWordsTrans))+
  geom_rect(data=data,aes(xmin = Date, xmax = Date+1,
                 ymin = -Inf, ymax = Inf,fill=Government),alpha=0.55)+
  geom_point(aes(x=Date,y=NumberWordsTrans))+
  geom_line(aes(x=Date,y=NumberWordsTrans)))
```

```{r}
data %>% 
  filter(!is.na(NumberWordsTrans)) %>%  
  .$NumberWordsTrans %>% 
  acf()
```


# ARIMA

```{r}
data %>% .$NumberWordsTrans %>% arima(c(0,0,1))
```



# MARIMA

```{r}
model <- marima::define.model(kvar = ncol(data), ar=0, ma=1, rem.var=c(1:3), reg.var = c(5:9), indep=NULL)
marima::marima(t(data), ar.pattern=model$ar.pattern, ma.pattern=model$ma.pattern)
```

```{r}
ar = c(0,1)
ma = c(0,1)
data2 <- data[3:nrow(data), 4:9]
model <- marima::define.model(kvar = ncol(data2), ma=ma, ar = ar, reg.var = c(2:6))
marima_model <- marima::marima(t(data2), ar.pattern=model$ar.pattern, ma.pattern=model$ma.pattern, Plot="log.det", penalty=.5, means = 1)

marima_model
# marima::short.form(marima_model$ma.estimates, leading = F)
# marima::short.form(marima_model$ar.estimates, leading = F)
```




























